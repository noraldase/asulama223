<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$SHIUA - Official Site</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(0px) rotate(12deg); }
            50% { transform: translateY(-10px) rotate(12deg); }
        }
        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        .animate-bounce-slow {
            animation: bounce-slow 2s ease-in-out infinite;
        }
        .animate-scroll-left {
            animation: scroll-left 20s linear infinite;
        }

        /* Progress Bar Styling (Simulasi Progress Shadcn) */
        .progress-root {
            position: relative;
            height: 1rem; /* h-4 */
            background-color: rgb(229 231 235); /* bg-gray-200 */
            border-radius: 9999px; /* rounded-full */
            overflow: hidden;
        }
        .progress-indicator {
            height: 100%;
            background-color: black; /* Default to black for visibility */
            transition: transform 0.6s ease;
        }
    </style>
</head>
<body class="min-h-screen bg-[#F5F0E8] overflow-x-hidden relative">

    <div id="main-content" class="min-h-screen bg-[#F5F0E8] overflow-hidden relative">
        <div id="bg-elements" class="absolute inset-0 overflow-hidden pointer-events-none">
            <div 
                id="bg-el-1"
                class="absolute top-20 left-10 w-64 h-64 rounded-full bg-purple-200 opacity-20 blur-3xl"
            ></div>
            <div 
                id="bg-el-2"
                class="absolute top-40 right-20 w-96 h-96 rounded-full bg-orange-200 opacity-20 blur-3xl"
            ></div>
            <div 
                id="bg-el-3"
                class="absolute bottom-20 left-1/3 w-80 h-80 rounded-full bg-green-200 opacity-20 blur-3xl"
            ></div>
        </div>

        <nav class="relative z-50 px-6 md:px-12 py-6 flex justify-between items-center">
            <div class="flex items-center gap-3">
    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg overflow-hidden">
        <img 
            src="logo.png" 
            alt="SHIBA Logo" 
            class="w-full h-full object-cover"
        >
    </div>
    <h1 class="text-3xl font-black">SHIUA X402</h1> 
    </div>
            
            <div class="flex items-center gap-4">
                <a 
                    href="https://twitter.com" 
                    target="https://x.com/ShiuaX402" 
                    rel="noopener noreferrer"
                    class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform duration-300"
                >
                    <i data-lucide="twitter" class="w-5 h-5"></i>
                </a>
                <button 
                    class="bg-white text-black font-bold px-6 py-6 rounded-full shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300 border-4 border-black"
                >
                    Connect Wallet
                </button>
            </div>
        </nav>

        <div class="relative z-10 container mx-auto px-6 md:px-12 py-12 md:py-20">
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div class="space-y-8">
                    <div class="space-y-4">
                        <h2 class="text-6xl md:text-8xl font-black leading-tight">
                            $SHIUA
                        </h2>
                        <p class="text-2xl font-bold">Total supply 1B</p>
                        
                        <div id="copy-container" class="flex items-center gap-3 bg-white p-4 rounded-2xl shadow-lg border-2 border-black max-w-md">
                            <code class="font-mono text-sm flex-1" id="contract-address-display">CA: 0xC0B3...4486C7</code>
                            <button
                                id="copy-button"
                                class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                            >
                                <i id="copy-icon" data-lucide="copy" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>

                    <div class="p-6 space-y-4 bg-white border-4 border-black shadow-xl rounded-3xl">
                        <p class="font-bold text-lg">1 USDC = 10,000 $SHIUA</p>
                        <div class="space-y-2">
                            <div class="progress-root">
                                <div id="progress-indicator" class="progress-indicator bg-black" style="width: 100%;"></div>
                            </div>
                            <div class="flex justify-between text-sm font-semibold">
                                <span>100%</span>
                                <span>100%</span>
                            </div>
                        </div>
                    </div>

                    <div class="inline-flex items-center gap-3 bg-gradient-to-r from-yellow-400 to-orange-400 px-8 py-4 rounded-full border-4 border-black shadow-xl transform hover:scale-105 transition-transform">
    <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center border-2 border-black overflow-hidden">
        <img 
            src="usdc.png" 
            alt="USDC Logo" 
            class="w-full h-full object-contain"
        >
    </div>
    <span class="text-2xl font-black">1</span>
</div>

                    <div class="inline-flex items-center gap-2 bg-blue-100 px-6 py-3 rounded-full border-2 border-blue-300">
                        <span class="text-xl">‚ùå</span>
                        <span class="font-bold">x402 Protocol Integrated</span>
                    </div>
                </div>

                <div class="relative flex justify-center items-center">
    <div class="relative animate-float">
        <img 
            src="logo.png" 
            alt="SHIBA X402 NFT"
            class="w-full max-w-md drop-shadow-2xl"
                        >
                            <path
                                d="M 100 30 
                                   Q 50 30, 40 80 
                                   Q 30 130, 40 180 
                                   L 40 230 
                                   Q 50 215, 60 230 
                                   Q 70 215, 80 230 
                                   Q 90 215, 100 230 
                                   Q 110 215, 120 230 
                                   Q 130 215, 140 230 
                                   Q 150 215, 160 230 
                                   L 160 180 
                                   Q 170 130, 160 80 
                                   Q 150 30, 100 30 Z"
                                fill="white"
                                stroke="black"
                                stroke-width="4"
                            />
                            
                            <circle cx="75" cy="90" r="15" fill="black" />
                            <circle cx="125" cy="90" r="15" fill="black" />
                            
                            <ellipse cx="100" cy="120" rx="20" ry="25" fill="black" />
                            <ellipse cx="100" cy="115" rx="15" ry="20" fill="#FF4444" />
                            
                            <path
                                d="M 40 100 Q 10 110, 20 130"
                                stroke="black"
                                stroke-width="4"
                                fill="white"
                            />
                            <path
                                d="M 160 100 Q 190 110, 180 130"
                                stroke="black"
                                stroke-width="4"
                                fill="white"
                            />
                        </svg>

                        <div class="absolute -top-10 -right-10 animate-bounce-slow">
                            <div class="bg-white px-6 py-3 rounded-2xl border-4 border-black shadow-xl transform rotate-12">
                                <p class="font-black text-3xl">
                                    <span class="text-orange-500">SHIUA</span>
                                    <span class="text-green-500">X</span>
                                    <span class="text-orange-500">402</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="absolute bottom-0 left-0 right-0 overflow-hidden">
    <div class="relative h-32 bg-gradient-to-r from-yellow-400 to-yellow-600"> <svg
            class="absolute top-0 w-full h-32"
            preserveAspectRatio="none"
            viewBox="0 0 1200 120"
                >
                    <path
                        d="M0,60 Q150,0 300,60 T600,60 T900,60 T1200,60 L1200,120 L0,120 Z"
                        fill="#F5F0E8"
                    />
                </svg>
                
                <div class="absolute inset-0 flex items-center justify-center overflow-hidden">
                    <div class="flex gap-8 animate-scroll-left whitespace-nowrap">
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                        <span class="text-black text-5xl md:text-6xl font-black transform -rotate-6">SHIUA</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

    <script>
        // --- KONFIGURASI FRONTEND ---
        const RELAYER_URL = "https://api.us-ai.fun/mint";
        const CONTRACT_SALE_MANAGER_ADDRESS = "0xED143D7C6195fD65C5b0a66F8d2B329E44ffE3D1"; 

        const USDC_CONTRACT_ADDRESS = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"; 
        const CHAIN_ID = 8453; // Base Mainnet
        const USDC_PRICE_TX = '1000000'; // 1 USDC

        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const mintTokenBtn = document.getElementById('mintTokenBtn');
        const statusMessage = document.getElementById('statusMessage');
        const errorMessage = document.getElementById('errorMessage');
        const gasDisplay = document.getElementById('gasDisplay');

        let signer;
        let provider;
        let userAddress;
        let ownerWalletAddress; 

        const saleManagerABI = [
            "function wallet() view returns (address)",
        ];

        // --- WALLET CONNECTION (DENGAN DETEKSI GAS & AMBIL OWNER WALLET) ---
        async function connectWallet() {
            errorMessage.textContent = '';
            statusMessage.textContent = 'Connecting...';
            gasDisplay.textContent = 'Fetching gas price...';

            if (typeof window.ethereum === 'undefined') {
                errorMessage.textContent = "Metamask not detected."; return;
            }
            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();

                const { chainId } = await provider.getNetwork();
                if (chainId !== CHAIN_ID) {
                    errorMessage.textContent = `Please switch to the Base Mainnet.`; return;
                }

                // Deteksi Harga Gas
                try {
                    const feeData = await provider.getFeeData();
                    const gasPriceInGwei = feeData.gasPrice.div(1000000000);
                    gasDisplay.textContent = `‚ö° Current Network Gas: ${gasPriceInGwei.toString()} Gwei`;
                } catch (gasError) {
                    gasDisplay.textContent = 'Could not fetch gas price.';
                }

                // Ambil alamat wallet owner
                statusMessage.textContent = 'Fetching sale configuration...';
                const saleContract = new ethers.Contract(CONTRACT_SALE_MANAGER_ADDRESS, saleManagerABI, provider);
                ownerWalletAddress = await saleContract.wallet();

                if (!ownerWalletAddress) {
                     errorMessage.textContent = 'Failed to read owner wallet address from contract.'; return;
                }

                connectWalletBtn.style.display = 'none';
                mintTokenBtn.style.display = 'block';
                mintTokenBtn.disabled = false;
                statusMessage.textContent = `Wallet Connected: ${userAddress.substring(0, 6)}...`;
            } catch (error) {
                console.error("Connection Error:", error);
                errorMessage.textContent = `Connection aborted or failed to read contract.`;
            }
        }

        // --- MINT FUNCTION (GASLESS) ---
        async function mintToken() {
            errorMessage.textContent = '';
            statusMessage.textContent = '1. Requesting Permit Signature';
            mintTokenBtn.disabled = true;

            if (!ownerWalletAddress) {
                errorMessage.textContent = "Owner wallet not loaded. Please reconnect.";
                mintTokenBtn.disabled = false;
                return;
            }

            let response; // Definisikan di luar try agar bisa diakses di catch
            try {
                // --- 1. Buat Tanda Tangan ---
                const currentTimestamp = Math.floor(Date.now() / 1000);
                const validBefore = currentTimestamp + (60 * 15);
                const validAfter = 0;
                const nonce = ethers.utils.solidityKeccak256(["uint256", "uint256"], [userAddress, Date.now()]);

                const domain = { name: 'USD Coin', version: '2', chainId: CHAIN_ID, verifyingContract: USDC_CONTRACT_ADDRESS };
                const types = { TransferWithAuthorization: [ { name: 'from', type: 'address' }, { name: 'to', type: 'address' }, { name: 'value', type: 'uint256' }, { name: 'validAfter', type: 'uint256' }, { name: 'validBefore', type: 'uint256' }, { name: 'nonce', type: 'bytes32' }, ] };
                const message = { from: userAddress, to: ownerWalletAddress, value: USDC_PRICE_TX, validAfter: validAfter, validBefore: validBefore, nonce: nonce };

                const signature = await signer._signTypedData(domain, types, message);
                const signatureParts = ethers.utils.splitSignature(signature);

                statusMessage.textContent = '2. Signature obtained. Sending to server... (Gasless)';

                // --- 2. KIRIM KE RELAYER ---
                const signatureBody = {
                    buyerAddress: userAddress,
                    validAfter: message.validAfter,
                    validBefore: message.validBefore,
                    nonce: message.nonce,
                    v: signatureParts.v,
                    r: signatureParts.r,
                    s: signatureParts.s
                };

                response = await fetch(RELAYER_URL, { // Assign ke variabel 'response'
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-PAYMENT': 'dummy=true' 
                    },
                    body: JSON.stringify(signatureBody) 
                });
                
                // --- 3. PROSES RESPONS DENGAN HATI-HATI ---
                if (!response.ok) { // Jika status BUKAN 2xx (misal 400, 500)
                    let errorMsg = `Server error (Status ${response.status})`;
                    try {
                         // Coba baca body error sebagai JSON
                         const errorBody = await response.json();
                         errorMsg = errorBody.error || errorMsg;
                    } catch (e) {
                         // Jika body error bukan JSON, baca sebagai teks
                         errorMsg = await response.text();
                    }
                    throw new Error(errorMsg); // Lemparkan error agar ditangkap di bawah
                }

                // Jika status OK (200), coba parse JSON
                let result;
                try {
                    result = await response.json();
                } catch (parseError) {
                    // Jika GAGAL parse JSON meskipun status 200 OK
                    console.error("Gagal parse JSON respons:", parseError);
                    // ANGGAP SUKSES KARENA SERVER MENGEMBALIKAN 200 OK
                    // Cari Tx Hash manual jika perlu, atau tampilkan pesan umum
                    statusMessage.innerHTML = `‚úÖ **Mint Likely Successful!** (Frontend failed to read Tx Hash). Check your wallet and Basescan.`;
                    // Jangan lempar error agar tidak menampilkan "Signature Failed"
                    return; // Keluar dari fungsi mintToken
                }
                
                // --- 4. TAMPILKAN HASIL SUKSES (JIKA JSON VALID) ---
                if (result.success && result.txHash) {
                    statusMessage.innerHTML = `‚úÖ **Mint Success!** 1000 $PONGUS sent! <br>Tx: <a href="https://basescan.org/tx/${result.txHash}" target="_blank">${result.txHash.substring(0,10)}...</a>`;
                } else {
                    // Jika JSON valid TAPI result.success = false
                    errorMessage.textContent = `Mint Failed: ${result.error || "Server reported failure."}`;
                }

            } catch (error) { // Menangkap SEMUA error (signature, fetch, parsing, dll)
                console.error("Minting process error:", error); // Log error asli ke konsol
                if (error.code === 4001) {
                    errorMessage.textContent = 'Transaction signature denied by the user.';
                } else {
                    // Tampilkan pesan error yang lebih informatif
                    errorMessage.textContent = `Mint Operation Failed: ${error.message || "Unknown error occurred."}`;
                }
            } finally {
                mintTokenBtn.disabled = false;
            }
        }
        connectWalletBtn.addEventListener('click', connectWallet);
        mintTokenBtn.addEventListener('click', mintToken);
    </script>
</body>
</html>
